#!/bin/bash

address_book="address_book.txt"

create_address_book() {
    if [[ ! -f "$address_book" ]]; 
    then
        touch "$address_book"
        echo "Address book created."
        echo "ID,Name,Phone" >> "$address_book"
        echo "--,----,-----" >> "$address_book"
        echo ""
    else
        echo "Address book already exists."
    fi
}

view_address_book() {
    if [[ -f "$address_book" && -s "$address_book" ]]; then
        echo "Displaying Address Book in Table format:"
        column -t -s "," "$address_book"
    else
        echo "Address book is empty or doesn't exist."
    fi
}

insert_record() {
    echo ""
    read -p "Enter ID: " id
    read -p "Enter name: " name
    read -p "Enter phone number: " phone
    echo "$id,$name,$phone" >> "$address_book"
    echo "Record inserted."
    echo ""
}

delete_record() {
    echo ""
    read -p "Enter the ID to delete: " id
    if grep -q "^$id," "$address_book"; 
    then
        grep -v "^$id," "$address_book" > temp.txt
        if [[ ! -s temp.txt ]]; then
            rm "$address_book"
            echo "The address book is now empty."
        else
            mv temp.txt "$address_book"
            echo "Record deleted."
        fi
    else
        echo "Record with ID $id not found."
    fi
    echo ""
}

modify_record() {
    echo ""
    read -p "Enter the ID to modify: " id
    if grep -q "^$id," "$address_book"; then
        read -p "Enter new name: " new_name
        read -p "Enter new phone number: " new_phone
        new_record="$id,$new_name,$new_phone"
        sed -i "/^$id,/c\\$new_record" "$address_book"
        echo "Record modified."
    else
        echo "Record with ID $id not found."
    fi
    echo ""
}

while true; do
    echo "----------------------------------------"
    echo "Address Book Menu:"
    echo "1. Create Address Book"
    echo "2. View Address Book"
    echo "3. Insert Record"
    echo "4. Delete Record"
    echo "5. Modify Record"
    echo "6. Exit"
    echo "----------------------------------------"
    read -p "Choose an option (1-6): " option

    case $option in
        1|c)
            create_address_book
            ;;
        2|v)
            view_address_book
            ;;
        3|i)
            insert_record
            ;;
        4|d)
            delete_record
            ;;
        5|m)
            modify_record
            ;;
        6|e)
            echo "Exiting the program."
            exit 0
            ;;
        *)
            echo "Invalid option. Please try again."
            ;;
    esac
done
